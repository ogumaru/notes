"use strict";(self.webpackChunknotes=self.webpackChunknotes||[]).push([[8731],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>d});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),u=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=u(e.components);return a.createElement(s.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,l=e.originalType,s=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),c=u(n),d=r,k=c["".concat(s,".").concat(d)]||c[d]||m[d]||l;return n?a.createElement(k,i(i({ref:t},p),{},{components:n})):a.createElement(k,i({ref:t},p))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=n.length,i=new Array(l);i[0]=c;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o.mdxType="string"==typeof e?e:r,i[1]=o;for(var u=2;u<l;u++)i[u]=n[u];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},7046:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>m,frontMatter:()=>l,metadata:()=>o,toc:()=>u});var a=n(7462),r=(n(7294),n(3905));const l={title:"\u3010Authelia\u3011Traefik\u3068Authelia\u3092\u5229\u7528\u3057\u3066SSO\u3092\u5c0e\u5165\u3059\u308b",authors:"ogumaru",tags:["traefik","docker","authelia"]},i=void 0,o={permalink:"/2023/04/19/introduce-sso-authelia",source:"@site/blog/2023-04-19-introduce-sso-authelia/index.md",title:"\u3010Authelia\u3011Traefik\u3068Authelia\u3092\u5229\u7528\u3057\u3066SSO\u3092\u5c0e\u5165\u3059\u308b",description:"\u6982\u8981",date:"2023-04-19T00:00:00.000Z",formattedDate:"2023\u5e744\u670819\u65e5",tags:[{label:"traefik",permalink:"/tags/traefik"},{label:"docker",permalink:"/tags/docker"},{label:"authelia",permalink:"/tags/authelia"}],readingTime:7.615,hasTruncateMarker:!1,authors:[{name:"ogumaru",title:"ogumaru note owner",url:"https://github.com/ogumaru",imageURL:"https://github.com/ogumaru.png",key:"ogumaru"}],frontMatter:{title:"\u3010Authelia\u3011Traefik\u3068Authelia\u3092\u5229\u7528\u3057\u3066SSO\u3092\u5c0e\u5165\u3059\u308b",authors:"ogumaru",tags:["traefik","docker","authelia"]},nextItem:{title:"\u3010YubiKey\u3011PIN\u3092\u9593\u9055\u3048\u305fYubiKey\u306e\u30ed\u30c3\u30af\u3092\u89e3\u9664\u3059\u308b",permalink:"/2023/01/15/unlock-yubikey-with-master-pw"}},s={authorsImageUrls:[void 0]},u=[{value:"\u6982\u8981",id:"\u6982\u8981",level:2},{value:"\u65b9\u91dd",id:"\u65b9\u91dd",level:2},{value:"Traefik \u306e\u8a2d\u5b9a",id:"traefik-\u306e\u8a2d\u5b9a",level:2},{value:"Authelia \u306e\u8a2d\u5b9a",id:"authelia-\u306e\u8a2d\u5b9a",level:2},{value:"\u5404\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u8a2d\u5b9a",id:"\u5404\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u8a2d\u5b9a",level:2},{value:"\u72ec\u81ea\u30ed\u30b0\u30a4\u30f3\u6a5f\u80fd\u306e\u7121\u52b9\u5316",id:"\u72ec\u81ea\u30ed\u30b0\u30a4\u30f3\u6a5f\u80fd\u306e\u7121\u52b9\u5316",level:3},{value:"\u4e0d\u8981\u8a2d\u5b9a\u3092\u89e3\u9664",id:"\u4e0d\u8981\u8a2d\u5b9a\u3092\u89e3\u9664",level:2},{value:"\u4f7f\u7528\u611f",id:"\u4f7f\u7528\u611f",level:2}],p={toc:u};function m(e){let{components:t,...l}=e;return(0,r.kt)("wrapper",(0,a.Z)({},p,l,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"\u6982\u8981"},"\u6982\u8981"),(0,r.kt)("p",null,"\u81ea\u5206\u7528\u306b\u8907\u6570\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u7a3c\u50cd\u3055\u305b\u3066\u3044\u308b\u30b5\u30fc\u30d0\u306b\u304a\u3044\u3066\u3001\u4ee5\u4e0b\u306b\u5bfe\u5fdc\u3059\u308b\u305f\u3081\u69cb\u6210\u3092\u5909\u66f4\u3059\u308b\u3053\u3068\u306b\u3057\u305f\u3002"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u4eca\u5f8c\u306f ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/siyuan-note/siyuan"},"SiYuan")," \u306e\u3088\u3046\u306a\u30ed\u30b0\u30a4\u30f3\u6a5f\u80fd\u3092\u6301\u305f\u306a\u3044\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3082\u81ea\u5206\u7528\u306b\u5b89\u5168\u306b\u516c\u958b\u3057\u305f\u3044\u3002"),(0,r.kt)("li",{parentName:"ol"},"PlantUML \u306f ",(0,r.kt)("a",{parentName:"li",href:"https://marketplace.visualstudio.com/items?itemName=jebbs.plantuml"},"VSCode \u306e\u62e1\u5f35\u6a5f\u80fd"),"\u304b\u3089\u3082\u5229\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u30d9\u30fc\u30b7\u30c3\u30af\u8a8d\u8a3c\u3092\u8a2d\u5b9a\u3057\u305f\u3044\u3002"),(0,r.kt)("li",{parentName:"ol"},"\u73fe\u72b6\u306f Shiori, Trilium Notes \u306a\u3069\u305d\u308c\u305e\u308c\u3067\u5225\u30a2\u30ab\u30a6\u30f3\u30c8\u3067\u306e\u30ed\u30b0\u30a4\u30f3\u304c\u5fc5\u8981\u306a\u306e\u3067\u3001\u30b7\u30f3\u30b0\u30eb\u30b5\u30a4\u30f3\u30aa\u30f3(SSO)\u306b\u5bfe\u5fdc\u3057\u305f\u3044\u3002"),(0,r.kt)("li",{parentName:"ol"},"SSL/TLS \u8a3c\u660e\u66f8\u306f",(0,r.kt)("inlineCode",{parentName:"li"},"certbot-renew.timer"),"\u3092\u5229\u7528\u3057\u3066\u5404\u30b5\u30d6\u30c9\u30e1\u30a4\u30f3\u3054\u3068\u306b\u66f4\u65b0\u3057\u3066\u3044\u305f\u304c\u3001",(0,r.kt)("inlineCode",{parentName:"li"},"*.example.com")," \u306e\u3088\u3046\u306a\u30ef\u30a4\u30eb\u30c9\u30ab\u30fc\u30c9\u8a3c\u660e\u66f8\u3092\u53d6\u5f97\u3057\u305f\u3044\u3002"),(0,r.kt)("li",{parentName:"ol"},"HTTP3 \u3092\u4f7f\u3063\u3066\u307f\u305f\u3044\u3002")),(0,r.kt)("h2",{id:"\u65b9\u91dd"},"\u65b9\u91dd"),(0,r.kt)("p",null,"\u4ee5\u4e0b\u306e\u7406\u7531\u304b\u3089\u3001\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u306f\u65e2\u5b58\u306e nginx \u304b\u3089 Traefik \u3078\u5909\u66f4\u3059\u308b\u3053\u3068\u306b\u3057\u305f\u3002"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u65e2\u5b58\u74b0\u5883\u304c Docker Compose \u4e0a\u306b\u69cb\u7bc9\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3002"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://doc.traefik.io/traefik/https/acme/#dnschallenge"},"dnsChallenge")," \u306e\u6307\u5b9a\u3067 DNS-01 \u30c1\u30e3\u30ec\u30f3\u30b8 \u306b\u3088\u308b\u30ef\u30a4\u30eb\u30c9\u30ab\u30fc\u30c9\u8a3c\u660e\u66f8\u53d6\u5f97\u304c\u3067\u304d\u308b\u3053\u3068\u3002"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://doc.traefik.io/traefik/middlewares/http/forwardauth/"},"fowardauth")," \u306b\u3088\u308a\u30e6\u30fc\u30b6\u8a8d\u8a3c\u3092\u631f\u3081\u308b\u3053\u3068\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u8a66\u9a13\u7684\u3067\u306f\u3042\u308b\u304c HTTP3 \u3092\u6709\u52b9\u306b\u3067\u304d\u308b\u3053\u3068\u3002 (nginx \u3067\u306f\u81ea\u5206\u3067\u30d3\u30eb\u30c9\u304c\u5fc5\u8981)")),(0,r.kt)("p",null,"\u30e6\u30fc\u30b6\u8a8d\u8a3c\u306b\u306f Keycloak \u3082\u691c\u8a0e\u3057\u305f\u304c\u3001\u5f53\u8a72\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30c7\u30a3\u30b9\u30af\u5bb9\u91cf\u304c\u5c11\u306a\u3044\u3053\u3068\u304b\u3089\u3001\u3088\u308a\u30b5\u30a4\u30ba\u306e\u5c0f\u3055\u3044 Authelia \u3092\u63a1\u7528\u3057\u305f\u3002"),(0,r.kt)("p",null,"\u30e1\u30e2\u30ea\u4f7f\u7528\u91cf\u306b\u3064\u3044\u3066\u306f\u6bd4\u8f03\u304c\u3067\u304d\u306a\u304b\u3063\u305f\u304c\u3001Go \u306e\u65b9\u304c\u5c11\u306a\u3044\u3060\u308d\u3046\u3068\u3044\u3046\u601d\u3044\u8fbc\u307f\u3082\u3042\u308b\u3002"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"\u9805\u76ee"),(0,r.kt)("th",{parentName:"tr",align:null},"Authelia"),(0,r.kt)("th",{parentName:"tr",align:null},"Keycloak"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Docker \u30a4\u30e1\u30fc\u30b8\u30b5\u30a4\u30ba"),(0,r.kt)("td",{parentName:"tr",align:null},"\u5c0f (\u7d04 55MB)"),(0,r.kt)("td",{parentName:"tr",align:null},"\u5927(\u7d04 450MB)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"\u5b9f\u88c5\u8a00\u8a9e"),(0,r.kt)("td",{parentName:"tr",align:null},"Go"),(0,r.kt)("td",{parentName:"tr",align:null},"Java")))),(0,r.kt)("p",null,"\u69cb\u6210\u306e\u6982\u8981\u56f3\u306f\u4ee5\u4e0b\u306e\u901a\u308a\u3002"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"\u6982\u8981\u56f3",src:n(4825).Z,title:"\u6982\u8981\u56f3",width:"1349",height:"956"})),(0,r.kt)("p",null,"\u5404\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u8a8d\u8a3c\u65b9\u5f0f\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308b\u3002"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3"),(0,r.kt)("th",{parentName:"tr",align:null},"\u65e7\u69cb\u6210"),(0,r.kt)("th",{parentName:"tr",align:null},"\u65b0\u69cb\u6210"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Shiori"),(0,r.kt)("td",{parentName:"tr",align:null},"\u72ec\u81ea\u8a8d\u8a3c"),(0,r.kt)("td",{parentName:"tr",align:null},"\u72ec\u81ea\u8a8d\u8a3c")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Trilium Notes"),(0,r.kt)("td",{parentName:"tr",align:null},"\u72ec\u81ea\u8a8d\u8a3c"),(0,r.kt)("td",{parentName:"tr",align:null},"\u30d1\u30b9\u30ef\u30fc\u30c9\u8a8d\u8a3c (SSO)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"PlantUML"),(0,r.kt)("td",{parentName:"tr",align:null},"\u8a8d\u8a3c\u306a\u3057"),(0,r.kt)("td",{parentName:"tr",align:null},"\u30d9\u30fc\u30b7\u30c3\u30af\u8a8d\u8a3c (SSO)")))),(0,r.kt)("p",null,"\u307e\u305f\u3001Authelia \u81ea\u8eab\u306e\u30ed\u30b0\u30a4\u30f3\u306b\u306f Web Authn \u306b\u3088\u308b\u4e8c\u6bb5\u968e\u8a8d\u8a3c\u3092\u8a2d\u5b9a\u3059\u308b\u3002"),(0,r.kt)("h2",{id:"traefik-\u306e\u8a2d\u5b9a"},"Traefik \u306e\u8a2d\u5b9a"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"traefik.yml")," \u306f\u4ee5\u4e0b\u306e\u901a\u308a\u3068\u3057\u305f\u3002"),(0,r.kt)("p",null,"\u691c\u8a3c\u306e\u969b\u306f ",(0,r.kt)("inlineCode",{parentName:"p"},"caServer: https://acme-staging-v02.api.letsencrypt.org/directory")," \u3092\u6709\u52b9\u306b\u3059\u308b\u3002"),(0,r.kt)("details",null,(0,r.kt)("summary",null,"traefik.yml"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},'global:\n  checknewversion: true\n  sendanonymoususage: false\n\nexperimental:\n  http3: true\n\nentryPoints:\n  web:\n    address: :80\n    # https\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\n    http:\n      redirections:\n        entrypoint:\n          to: webSecure\n          scheme: https\n  webSecure:\n    address: :443\n    http:\n      tls: true\n    http3: {}\n\napi:\n  insecure: false\n  dashboard: true\n\nproviders:\n  file:\n    directory: /etc/traefik/\n  docker:\n    exposedByDefault: false\n\ncertificatesResolvers:\n  myresolver:\n    acme:\n      email: hoge@example.com\n      storage: /letsencrypt/acme.json\n      # caServer: https://acme-staging-v02.api.letsencrypt.org/directory\n      dnsChallenge:\n        provider: gandiv5\n        resolvers:\n          - "ns-a.example.com:53"\n          - "ns-b.example.com:53"\n          - "ns-c.example.com:53"\n      keyType: EC384\n'))),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"compose.yaml"),"\u306e\u30b3\u30f3\u30c6\u30ca\u8a2d\u5b9a\u306f\u4ee5\u4e0b\u3002"),(0,r.kt)("p",null,"Gandi \u3067\u30c9\u30e1\u30a4\u30f3\u3092\u53d6\u5f97\u3057\u3066\u3044\u308b\u305f\u3081\u3001\u30ef\u30a4\u30eb\u30c9\u30ab\u30fc\u30c9\u8a3c\u660e\u66f8\u53d6\u5f97\u306e\u305f\u3081\u306b ",(0,r.kt)("inlineCode",{parentName:"p"},"GANDIV5_API_KEY")," \u3092\u74b0\u5883\u5909\u6570\u3068\u3057\u3066\u6e21\u3059\u3002"),(0,r.kt)("p",null,"\u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u3068\u3057\u3066\u6307\u5b9a\u3055\u308c\u3066\u3044\u308b ",(0,r.kt)("inlineCode",{parentName:"p"},"auth@docker")," \u306f\u5f8c\u8ff0\u306e Authelia \u306e\u30b3\u30f3\u30c6\u30ca\u3092\u6307\u3057\u3066\u3044\u308b\u3002"),(0,r.kt)("details",null,(0,r.kt)("summary",null,"compose.yaml"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},'services:\n  traefik:\n    image: "traefik:v2.9"\n    container_name: traefik\n    ports:\n      - "80:80"\n      - "443:443"\n    environment:\n      GANDIV5_API_KEY: "${GANDIV5_API_KEY}"\n    labels:\n      traefik.enable: true\n      traefik.http.routers.api.service: api@internal\n      traefik.http.routers.api.rule: Host(`traefik.example.com`) && PathPrefix(`/api`)\n      traefik.http.routers.api.entrypoints: webSecure\n      traefik.http.routers.api.tls.certresolver: myresolver\n      traefik.http.routers.api.middlewares: auth@docker\n\n      traefik.http.routers.dashboard.service: dashboard@internal\n      traefik.http.routers.dashboard.rule: Host(`traefik.example.com`) && PathPrefix(`/dashboard`)\n      traefik.http.routers.dashboard.entrypoints: webSecure\n      traefik.http.routers.dashboard.tls.certresolver: myresolver\n      traefik.http.routers.dashboard.middlewares: strip-auth\n      traefik.http.middlewares.strip-auth.chain.middlewares: auth@docker,dashboard-stripprefix\n      traefik.http.middlewares.dashboard-stripprefix.stripprefix.prefixes: /dashboard\n\n      traefik.http.routers.wildcard-certs.tls.certresolver: myresolver\n      traefik.http.routers.wildcard-certs.tls.domains[0].main: example.com\n      traefik.http.routers.wildcard-certs.tls.domains[0].sans: "*.example.com"\n    volumes:\n      - /var/run/docker.sock:/var/run/docker.sock:ro\n      # rootless-docker\n      # - //run/user/1000/docker.sock:/var/run/docker.sock:ro\n      - ${PWD}/traefik/:/etc/traefik/:ro\n      - ${PWD}/letsencrypt/:/letsencrypt/\n    restart: unless-stopped\n'))),(0,r.kt)("h2",{id:"authelia-\u306e\u8a2d\u5b9a"},"Authelia \u306e\u8a2d\u5b9a"),(0,r.kt)("p",null,"\u9375\u306e\u5024\u306a\u3069\u79d8\u5bc6\u60c5\u5831\u304c\u3042\u308b\u304c\u3001\u305d\u308c\u3089\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u306f\u74b0\u5883\u5909\u6570\u3067\u306f\u306a\u304f ",(0,r.kt)("inlineCode",{parentName:"p"},"secrets")," \u306b\u6307\u5b9a\u3057\u3066\u6e21\u3059\u3002"),(0,r.kt)("p",null,"\u30b3\u30f3\u30c6\u30ca\u5074\u306e ",(0,r.kt)("inlineCode",{parentName:"p"},"secrets")," \u3067\u5229\u7528\u3059\u308b\u3082\u306e\u3092\u6307\u5b9a\u3057\u305f\u4e0a\u3067\u3001",(0,r.kt)("inlineCode",{parentName:"p"},"/run/secrets/")," \u5185\u306e\u30d5\u30a1\u30a4\u30eb\u540d\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068\u3001\u30d5\u30a1\u30a4\u30eb\u306e\u5185\u5bb9\u304c\u5c55\u958b\u3055\u308c\u3066\u53c2\u7167\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"A secret value can be loaded by Authelia when the configuration key ends with one of the following words: key, secret, password, or token.")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://www.authelia.com/configuration/methods/secrets/"},"Secrets - Configuration - Authelia - (www.authelia.com)")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"compose.yaml")," \u306e ",(0,r.kt)("inlineCode",{parentName:"p"},"secrets")," \u90e8\u5206\u306e\u8a18\u8ff0\u306f\u4ee5\u4e0b\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},'secrets:\n  authelia_jwt_secret_file:\n    file: "${PWD}/secrets/authelia/jwt_secret.txt"\n  authelia_session_secret_file:\n    file: "${PWD}/secrets/authelia/session.secret.txt"\n  authelia_storage_encryption_key_file:\n    file: "${PWD}/secrets/authelia/storate.encryption_key.txt"\n')),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"compose.yaml")," \u306e\u30b3\u30f3\u30c6\u30ca\u306e\u8a2d\u5b9a\u306f\u4ee5\u4e0b\u3002"),(0,r.kt)("details",null,(0,r.kt)("summary",null,"compose.yaml"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},'auth:\n  container_name: auth\n  image: authelia/authelia:4.37\n  restart: unless-stopped\n  command: ["--config", "/config/configuration.yml"]\n  volumes:\n    - ${PWD}/authelia-data/config/:/config/\n  environment:\n    TZ: "Asia/Tokyo"\n    AUTHELIA_JWT_SECRET_FILE: "/run/secrets/authelia_jwt_secret_file"\n    AUTHELIA_SESSION_SECRET_FILE: "/run/secrets/authelia_session_secret_file"\n    AUTHELIA_STORAGE_ENCRYPTION_KEY_FILE: "/run/secrets/authelia_storage_encryption_key_file"\n  labels:\n    traefik.enable: true\n    traefik.http.routers.auth.rule: Host(`auth.example.com`)\n    traefik.http.routers.auth.entryPoints: webSecure\n    traefik.http.routers.auth.tls.certresolver: myresolver\n\n    traefik.http.middlewares.auth.forwardAuth.address: http://auth:9091/api/verify?rd=https%3A%2F%2Fauth.example.com%2F\n    traefik.http.middlewares.auth.forwardAuth.trustForwardHeader: true\n    traefik.http.middlewares.auth.forwardAuth.authResponseHeaders: Remote-User,Remote-Groups,Remote-Name,Remote-Email\n    traefik.http.middlewares.auth-basic.forwardAuth.address: http://auth:9091/api/verify?auth=basic\n    traefik.http.middlewares.auth-basic.forwardAuth.trustForwardHeader: true\n    traefik.http.middlewares.auth-basic.forwardAuth.authResponseHeaders: Remote-User,Remote-Groups,Remote-Name,Remote-Email\n  deploy:\n    resources:\n      limits:\n        cpus: "1.0"\n        memory: 250M\n  secrets:\n    - authelia_jwt_secret_file\n    - authelia_session_secret_file\n    - authelia_storage_encryption_key_file\n'))),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"traefik.http.middlewares.auth-basic")," \u306f\u30d9\u30fc\u30b7\u30c3\u30af\u8a8d\u8a3c\u306e\u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u3001\n",(0,r.kt)("inlineCode",{parentName:"p"},"traefik.http.middlewares.auth")," \u306f\u30d1\u30b9\u30ef\u30fc\u30c9\u8a8d\u8a3c\u306e\u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u3068\u306a\u308b\u3002"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"argon2")," \u306b\u3088\u308b\u8a8d\u8a3c\u306e\u5834\u5408\u3001\u30ed\u30b0\u30a4\u30f3\u6642\u306b\u8ca0\u8377\u304c\u9ad8\u307e\u308b\u305f\u3081\u30ea\u30bd\u30fc\u30b9\u5236\u9650\u3057\u305f\u307b\u3046\u304c\u5b89\u5b9a\u3057\u305f\u3002"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"configuration.yml")," \u306f\u4ee5\u4e0b\u3002"),(0,r.kt)("details",null,(0,r.kt)("summary",null,"configuration.yml"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},'theme: light\n# AUTHELIA_JWT_SECRET_FILE\n# jwt_secret: ****\ndefault_2fa_method: webauthn\nserver:\n  host: 0.0.0.0\n  port: 9091\n  path: ""\n  enable_pprof: false\n  enable_expvars: false\n  disable_healthcheck: false\n  headers:\n    csp_template: ""\n    # csp_template: "default-src \'self\'; frame-src \'none\'; object-src \'none\'; style-src \'self\' \'unsafe-inline\' \'nonce-********\'; frame-ancestors \'none\'; base-uri \'self\'"\n\nauthentication_backend:\n  file:\n    path: /config/users.yml\n    watch: false\n    search:\n      email: false\n      case_insensitive: false\n    password:\n      algorithm: argon2\n      argon2:\n        variant: argon2id\n        iterations: 3\n        memory: 65536\n        parallelism: 4\n        key_length: 32\n        salt_length: 16\n\nwebauthn:\n  disable: false\n  display_name: "Hoge Auth"\n  attestation_conveyance_preference: indirect\n  user_verification: preferred\n  timeout: 60s\n\nsession:\n  name: authelia_session\n  domain: example.com\n  same_site: strict\n  # AUTHELIA_SESSION_SECRET_FILE\n  # secret: ****\n  expiration: 7d\n  inactivity: 12h\n  remember_me_duration: 1M\n\naccess_control:\n  default_policy: deny\n  rules:\n    - domain: "auth.example.com"\n      policy: two_factor\n    - domain: ["traefik.example.com", "trilium.example.com"]\n      policy: one_factor\n      subject:\n        - "group:admin"\n    - domain: "plantuml.example.com"\n      policy: one_factor\n      subject:\n        - "group:admin"\n        - "group:guest"\n\nstorage:\n  local:\n    path: /config/db.sqlite3\n  # AUTHELIA_STORAGE_ENCRYPTION_KEY_FILE\n  # encryption_key: ****\n\nnotifier:\n  filesystem:\n    filename: /config/notification.txt\n'))),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"argon2")," \u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u306b\u3064\u3044\u3066\u306f\u3000",(0,r.kt)("a",{parentName:"p",href:"https://www.rfc-editor.org/rfc/rfc9106.html"},"RFC 9106")," \u306e\u4ee5\u4e0b\u3092\u53c2\u8003\u306b\u8a2d\u5b9a\u3057\u305f\u3002"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"If much less memory is available, a uniformly safe option is Argon2id with t=3 iterations, p=4 lanes, m=2^(16) (64 MiB of RAM), 128-bit salt, and 256-bit tag size. This is the SECOND RECOMMENDED option.")),(0,r.kt)("p",null,"VSCode \u3067\u306e PlantUML \u5229\u7528\u6642\u3001\u30d9\u30fc\u30b7\u30c3\u30af\u8a8d\u8a3c\u60c5\u5831\u3092\u5e73\u6587\u3067\u66f8\u304f\u5fc5\u8981\u304c\u3042\u308b\u305f\u3081\u3001PlantUML \u7528\u306e\u30b2\u30b9\u30c8\u30e6\u30fc\u30b6 (",(0,r.kt)("inlineCode",{parentName:"p"},"group:guest"),") \u3092\u4f5c\u6210\u3057 ",(0,r.kt)("inlineCode",{parentName:"p"},"plantuml.example.com")," \u306e\u307f\u8a31\u53ef\u3059\u308b\u3088\u3046\u306b\u3057\u305f\u3002"),(0,r.kt)("h2",{id:"\u5404\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u8a2d\u5b9a"},"\u5404\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u8a2d\u5b9a"),(0,r.kt)("p",null,"\u305d\u308c\u305e\u308c\u5229\u7528\u3059\u308b\u8a8d\u8a3c\u65b9\u5f0f\u306b\u3042\u3063\u305f\u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u3092\u6307\u5b9a\u3057\u305f\u3002"),(0,r.kt)("details",null,(0,r.kt)("summary",null,"compose.yaml"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},'shiori:\n  image: ghcr.io/go-shiori/shiori:v1.5.4-6-g888e59d\n  container_name: shiori\n  volumes:\n    - "${PWD}/shiori:/shiori"\n  labels:\n    traefik.enable: true\n    traefik.http.routers.shiori.rule: Host(`shiori.example.com`)\n    traefik.http.routers.shiori.entrypoints: webSecure\n    traefik.http.routers.shiori.tls.certresolver: myresolver\n  environment:\n    - PUID=1000\n    - PGID=1000\n  restart: unless-stopped\n\nplantuml:\n  image: plantuml/plantuml-server:jetty-v1.2023.1\n  container_name: plantuml\n  command: --module=http-forwarded\n  labels:\n    traefik.enable: true\n    traefik.http.routers.plantuml.rule: Host(`plantuml.example.com`)\n    traefik.http.routers.plantuml.entrypoints: webSecure\n    traefik.http.routers.plantuml.tls.certresolver: myresolver\n    traefik.http.routers.plantuml.middlewares: auth-basic@docker\n  restart: unless-stopped\n\ntrilium:\n  image: zadam/trilium:0.59.3\n  container_name: trilium\n  volumes:\n    - "${PWD}/trilium-data:/home/node/trilium-data"\n  environment:\n    - USER_UID=1000\n    - USER_GID=1000\n  labels:\n    traefik.enable: true\n    traefik.http.routers.trilium.rule: Host(`trilium.example.com`)\n    traefik.http.routers.trilium.entrypoints: webSecure\n    traefik.http.routers.trilium.tls.certresolver: myresolver\n    traefik.http.routers.trilium.middlewares: auth@docker\n  restart: unless-stopped\n'))),(0,r.kt)("h3",{id:"\u72ec\u81ea\u30ed\u30b0\u30a4\u30f3\u6a5f\u80fd\u306e\u7121\u52b9\u5316"},"\u72ec\u81ea\u30ed\u30b0\u30a4\u30f3\u6a5f\u80fd\u306e\u7121\u52b9\u5316"),(0,r.kt)("p",null,"Shiori \u306f\u30ed\u30b0\u30a4\u30f3\u6a5f\u80fd\u3092\u7121\u52b9\u306b\u3067\u304d\u306a\u304b\u3063\u305f\u305f\u3081\u3001Authelia \u306b\u3088\u308b\u8a8d\u8a3c\u3092\u30d0\u30a4\u30d1\u30b9\u3059\u308b\u3002"),(0,r.kt)("p",null,"Trilium Notes \u306f ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/zadam/trilium/wiki/Server-installation#disable-authentication"},"Disable authentication")," \u306e\u901a\u308a ",(0,r.kt)("inlineCode",{parentName:"p"},"config.ini")," \u3067\u4ee5\u4e0b\u8a2d\u5b9a\u3092\u884c\u3046\u3068\u53ef\u80fd\u3060\u3063\u305f\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ini"},"[General]\nnoAuthentication=true\n")),(0,r.kt)("h2",{id:"\u4e0d\u8981\u8a2d\u5b9a\u3092\u89e3\u9664"},"\u4e0d\u8981\u8a2d\u5b9a\u3092\u89e3\u9664"),(0,r.kt)("p",null,"\u5f93\u6765\u5229\u7528\u3057\u3066\u3044\u305f SSL/TLS \u8a3c\u660e\u66f8\u306e\u81ea\u52d5\u66f4\u65b0\u3092\u7121\u52b9\u5316\u3059\u308b\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo systemctl disable certbot-renew.timer\n# > Removed symlink /etc/systemd/system/timers.target.wants/certbot-renew.timer.\n")),(0,r.kt)("h2",{id:"\u4f7f\u7528\u611f"},"\u4f7f\u7528\u611f"),(0,r.kt)("p",null,"\u305d\u308c\u81ea\u8eab\u304c\u91cd\u3044\u305f\u3081\u3001\u79fb\u884c\u524d\u304b\u3089 PlantUML \u306e\u5229\u7528\u306f\u5b89\u5b9a\u3057\u306a\u304b\u3063\u305f\u304c\u3001\u305d\u308c\u4ee5\u5916\u306b\u3064\u3044\u3066\u306f t4g.micro \u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9( RAM 512 MB, \u30b9\u30ef\u30c3\u30d7 1GB) \u3067\u3082\u4f7f\u7528\u611f\u306b\u554f\u984c\u306f\u306a\u304b\u3063\u305f\u3002"))}m.isMDXComponent=!0},4825:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/outline-b7dc265bc86b3f3d05b955e7139cdda7.png"}}]);